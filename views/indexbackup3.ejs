<!DOCTYPE html>

<html>
<body>
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
  <%- include /layouts/header.ejs %>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/index.css">

  <script src="http://code.jquery.com/jquery-2.2.0.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js">
  
  <script>
    function getData() {
        var arr = [];
        for(let i=0;i<10;i++){
            arr.push(Array(10).fill().map(() => Math.random()))
	}
        return arr;
    }
    $(document).ready(function(){
        var stock_input;
        $("#submit").click(function(){
            stock_input=$("#stock_input").val();
            $.post("http://localhost:5000",{stock_input: stock_input}, function(data){
                if(data==='done')
                {
                    alert("request success");
                }
            });
        });

	Plotly.d3.csv("https://api.iextrading.com/1.0/stock/amzn/chart/1m", function(err, rows){
            function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; });
        }

        var trace1 = {
  type: "scatter",
  mode: "lines",
  name: 'AAPL High',
  x: unpack(rows, 'Date'),
  y: unpack(rows, 'High'),
  line: {color: '#17BECF'}
}

var trace2 = {
  type: "scatter",
  mode: "lines",
  name: 'AAPL Low',
  x: unpack(rows, 'Date'),
  y: unpack(rows, 'Low'),
  line: {color: '#7F7F7F'}
}

var data = [trace1,trace2];

var layout = {
  title: 'Basic Time Series',
};

Plotly.newPlot('myDiv', data, layout);
})



	var $company = {}
	var arrHigh = []
	var arrLow = []
	var arrDate = []
        var bookmark_placeholders = ["https://api.iextrading.com/1.0/stock/aapl/chart/1m",
				     "https://api.iextrading.com/1.0/stock/amzn/chart/1m",
				     "https://api.iextrading.com/1.0/stock/msft/chart/1m",
                                     "https://api.iextrading.com/1.0/stock/nflx/chart/1m"]
        for(var i = 0; i < bookmark_placeholders.length; i++){
        
            $.getJSON(bookmark_placeholders[i],function(json){
                var stock_url
                var current_bookmark = bookmark_placeholders[i];
                $.ajax({url:current_bookmark, dataType:"jsonp"}).then(function(data){
	            for(var j = 0; j < 10; j++){
	                arrHigh.push(data[j].high)
		        arrLow.push(data[j].low)
			arrDate.push(data[j].date)
		    }
	        }
	    }

        });
      }

    }

  </script>
</head>

  <h1>INDEX PAGE</h1>
  <h2><a href="stockSelect"> StockSelect</a> </h2>
  
  <div class="container-fluid">
  	<h3> Your Stocks </h3>
    <div class="row">
        <div class="col-sm-8 pd_none">
            <form>
        		<button type="button" id="btn2" class="btn stock-btn">Load data (AAPL 1d)</button>
        	</form>
        </div>
    </div>
  
  </div>


<td>Select a stock symbol: </td>
<input type="TEXT" id="stock_input" size="8">
<input type="button" id="submit" value="Submit">





<table>
  <tr>
    <th>date</th><th>high</th>
  </tr>
  <% data.forEach(function(data, index) { %>
    <tr>
      <td><%= data.date %></td>
      <td><%= data.high %></td>
    </tr>    
  <% }) %>
</table>



<th>test</th>

<ul>
  <% data.forEach(function(data){ %>
    <%= data.date %>
    <%= data.high %>
  <% })%>
</ul>


<form action="/" method="post" name="form1">
    <table width="25%" border="0">
        <tr>

        </tr>
    </table>
</form>

  <script>https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js </script>
  <script type="text/javascript"  src="./routes/index"></script>
</body>
</html>
